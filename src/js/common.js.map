{"version":3,"sources":["src/common.js"],"names":["UNAUTHORIZED","axios","interceptors","response","use","error","status","localStorage","removeItem","window","location","href","Promise","reject","apiUrl","ROLE","roleName","authPath","pathname","accessToken","getItem","startsWith","$","hide","method","url","headers","Authorization","then","res","data","setItem","JSON","stringify","append","Username","RoleId","show","findIndex","path","history","back","catch","console","log","on","e","preventDefault","userName","password","val","trim","addClass","access_token","toastr","success","click"],"mappings":"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","sourcesContent":["import $ from 'jquery'\nimport axios from 'axios'\nimport toastr from 'toastr'\nconst UNAUTHORIZED = 401\naxios.interceptors.response.use(\n  (response) => response,\n  (error) => {\n    const {\n      status\n    } = error.response\n    if (status === UNAUTHORIZED) {\n      localStorage.removeItem('accessToken')\n      window.location.href = '/login.html'\n    }\n    return Promise.reject(error)\n  }\n)\nconst apiUrl = 'http://192.168.43.211:44396/'\nconst ROLE = {\n  1: {\n    roleName: 'Admin',\n    authPath: ['/admin/', '/admin/user-list.html', '/admin/create-user.html', '/admin/edit-user.html']\n  },\n  2: {\n    roleName: 'Manager',\n    authPath: ['/admin/']\n  },\n  3: {\n    roleName: 'Teacher',\n    authPath: ['/admin/', '/admin/create-compertition.html', '/admin/awards.html', '/admin/compertition-detail.html', '/admin/posting.html', '/admin/posting-detail.html', '/admin/upcoming-compertition.html']\n  },\n  4: {\n    roleName: 'Student',\n    authPath: ['/admin/', '/admin/upcoming-compertition.html', '/admin/compertition-detail.html', '/admin/create-posting.html', '/admin/posting.html', '/admin/posting-detail.html']\n  }\n}\n// if have token, login page will redirrect to admin\nif (window.location.pathname === '/login.html') {\n  const accessToken = localStorage.getItem('accessToken')\n  if (accessToken) {\n    window.location.href = '/admin/'\n  }\n}\n// auth admin page, get user infor\nif (window.location.pathname.startsWith('/admin')) {\n  const accessToken = localStorage.getItem('accessToken')\n  if (!accessToken) {\n    window.location.href = '/login.html'\n  } else {\n    // hide all auth role element\n    $('[data-role]').hide()\n    // get current user infor\n    axios({\n      method: 'get',\n      url: `${apiUrl}/user/me`,\n      headers: {\n        Authorization: `bearer ${localStorage.getItem('accessToken')}`\n      }\n    })\n      .then((res) => {\n        // if dont have user data then logout\n        if (!(res && res.data)) {\n          window.location.href = '/login.html'\n        }\n        // set user data into view\n        const {\n          data\n        } = res\n        localStorage.setItem('me',  JSON.stringify(data))\n        $('#userName').append(data.Username)\n        $('#userRole').append(ROLE[data.RoleId].roleName)\n        // show only matching role auth element\n        $(`[data-role*=\"${data.RoleId}\"]`).show()\n        // if not match route auth then logout\n        const {\n          authPath\n        } = ROLE[data.RoleId]\n\n        if (authPath.findIndex((path) => path === window.location.pathname) === -1) {\n          window.history.back()\n        }\n      }).catch((res) => console.log(res))\n  }\n}\n\n// login\n$('#loginForm').on('submit', (e) => {\n  e.preventDefault()\n  const userName = $('#username')\n  const password = $('#password')\n  if (!userName.val().trim()) {\n    userName.addClass('is-invalid')\n  } else if (!password.val().trim()) {\n    password.addClass('is-invalid')\n  } else {\n    axios({\n      method: 'post',\n      url: `${apiUrl}Token`,\n      headers: {\n        'Access-Control-Allow-Origin': '*',\n        'Access-Control-Allow-Credentials': 'true',\n        'Content-Type': 'application/x-www-form-urlencoded'\n      },\n      data: `grant_type=password&username=${userName.val()}&password=${password.val()}`\n    }).then((res) => {\n      if (res && res.data && res.data.access_token) {\n        localStorage.setItem('accessToken', res.data.access_token)\n        toastr.success('Login successful!')\n        window.location.href = '/admin'\n      }\n    })\n      .catch(() => toastr.error('Login failed!'))\n  }\n})\n\n// Logout\n$('#logout').click((e) => {\n  e.preventDefault()\n  localStorage.removeItem('accessToken')\n  localStorage.removeItem('me')\n  window.location.href = '/login.html'\n})\n"],"file":"common.js"}